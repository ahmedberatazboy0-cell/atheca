// Grafik nesnesi
const ctx = document.getElementById('trafficChart').getContext('2d');
const trafficChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [
            { 
                label: 'Upload (B/s)', 
                data: [], 
                borderColor: '#0f0', 
                backgroundColor: 'rgba(0,255,0,0.1)',
                fill: true
            },
            { 
                label: 'Download (B/s)', 
                data: [], 
                borderColor: '#f0f', 
                backgroundColor: 'rgba(255,0,255,0.1)',
                fill: true
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: { 
            x: { ticks: { color: '#0f0' } }, 
            y: { ticks: { color: '#0f0' } } 
        },
        plugins: {
            legend: { labels: { color: '#0f0' } }
        }
    }
});

// Rastgele sayÄ± Ã¼reteci (aralÄ±k dahil)
function random(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

// Rastgele IP Ã¼reteci (192.168.0.x)
function randomIP() {
    return '192.168.0.' + random(2, 254);
}

// GeÃ§miÅŸ veri havuzu (20 adet)
let history = [];
for (let i = 0; i < 20; i++) {
    history.push({ time: '00:00', up: random(1000, 5000), down: random(2000, 8000) });
}

// DDoS uyarÄ± listesi
let ddosAlerts = [];

// BaÄŸlÄ± cihaz listesi (IP'ler)
let connectedDevices = [];

// Ana gÃ¼ncelleme fonksiyonu
function updateDashboard() {
    // --- BAÄžLI CÄ°HAZLAR (simÃ¼lasyon) ---
    const deviceCount = random(2, 8); // 2 ile 8 arasÄ± cihaz
    document.getElementById('clients-count').innerText = deviceCount + '/8';
    document.getElementById('clients-bar').style.width = (deviceCount / 8 * 100) + '%';

    // Rastgele IP listesi oluÅŸtur
    connectedDevices = [];
    for (let i = 0; i < deviceCount; i++) {
        connectedDevices.push(randomIP());
    }
    // IP listesini gÃ¶ster (opsiyonel)
    const deviceListDiv = document.getElementById('device-list');
    if (deviceListDiv) {
        deviceListDiv.innerHTML = 'ðŸ“¡ ' + connectedDevices.join(' Â· ');
    }

    // --- TRAFÄ°K (B/s) ---
    const up = random(1000, 10000);
    const down = random(2000, 15000);
    document.getElementById('upload-speed').innerText = up;
    document.getElementById('download-speed').innerText = down;

    // Grafik zaman etiketi (sa:dakika)
    const now = new Date();
    const timeStr = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');
    history.push({ time: timeStr, up: up, down: down });
    if (history.length > 20) history.shift();

    trafficChart.data.labels = history.map(item => item.time);
    trafficChart.data.datasets[0].data = history.map(item => item.up);
    trafficChart.data.datasets[1].data = history.map(item => item.down);
    trafficChart.update();

    // --- DDoS Ä°STATÄ°STÄ°KLERÄ° ---
    const reqPerSec = random(10, 50);
    document.getElementById('requests-per-sec').innerText = reqPerSec;

    // Rastgele DDoS uyarÄ±sÄ± Ã¼ret (%20 ihtimal)
    if (Math.random() > 0.8) {
        const alertIp = randomIP();
        ddosAlerts.push({ 
            ip: alertIp, 
            time: now.toLocaleTimeString('tr-TR'), 
            count: random(31, 60) 
        });
        if (ddosAlerts.length > 10) ddosAlerts.shift();
    }

    const logsDiv = document.getElementById('ddos-logs');
    logsDiv.innerHTML = '';
    ddosAlerts.slice().reverse().forEach(alert => {
        logsDiv.innerHTML += `<div>[${alert.time}] ${alert.ip} (${alert.count})</div>`;
    });

    // --- SÄ°STEM BÄ°LGÄ°LERÄ° (CPU, RAM) ---
    document.getElementById('cpu-usage').innerText = '%' + random(5, 60);
    document.getElementById('ram-usage').innerText = '%' + random(20, 70);

    // --- HIZ BÄ°LGÄ°LERÄ° (Mbps) 40 Mbps civarÄ± ---
    document.getElementById('speed-download').innerText = random(35, 45); // 35-45 Mbps
    document.getElementById('speed-upload').innerText = random(8, 12);    // 8-12 Mbps
}

// --- BUTON Ä°ÅžLEVLERÄ° (simÃ¼lasyon uyarÄ±larÄ±) ---
document.getElementById('internet-kes').addEventListener('click', () => alert('âš ï¸ Ä°nternet kesildi (simÃ¼lasyon)'));
document.getElementById('internet-ac').addEventListener('click', () => alert('ðŸŒ Ä°nternet aÃ§Ä±ldÄ± (simÃ¼lasyon)'));
document.getElementById('fan-cold').addEventListener('click', () => {
    document.getElementById('cold-mode-status').innerText = 'AKTÄ°F';
    alert('â„ï¸ Cold mod aktif (iÅŸlemci yÃ¼kÃ¼ azaltÄ±ldÄ± - simÃ¼lasyon)');
});
document.getElementById('fan-normal').addEventListener('click', () => {
    document.getElementById('cold-mode-status').innerText = 'PASÄ°F';
    alert('ðŸ”¥ Normal mod (simÃ¼lasyon)');
});

// --- PERÄ°YODÄ°K GÃœNCELLEME ---
updateDashboard(); // hemen bir kere Ã§alÄ±ÅŸtÄ±r
setInterval(updateDashboard, 2000); // 2 saniyede bir tekrarla
